{% extends "base.html" %}

{% block title %}SchichtwÃ¼nsche{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Header -->
     <!-- In wunsch_perioden_liste.html -->
{% if ist_planer %}
    <div class="mb-4">
        <a href="{% url 'schichtplan:periode_erstellen' %}" class="btn btn-primary">
            â• Neue Wunschperiode anlegen
        </a>
    </div>
{% endif %}

{% if perioden %}
    <!-- Deine Liste der Perioden -->
{% else %}
    <div class="alert alert-warning">
        âš ï¸ Keine Wunschperioden verfÃ¼gbar...
    </div>
{% endif %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2>ğŸ—“ï¸ Meine SchichtwÃ¼nsche</h2>
            <p class="text-muted">
                Willkommen, {{ mitarbeiter.vollname }} ({{ mitarbeiter.schichtplan_kennung }})
            </p>
        </div>
        <a href="{% url 'arbeitszeit:dashboard' %}" class="btn btn-secondary">
            â† ZurÃ¼ck
        </a>
    </div>

    <!-- Info-Box -->
    <div class="alert alert-info">
        <h5>â„¹ï¸ So funktioniert's:</h5>
        <ol class="mb-0">
            <li>WÃ¤hle eine Wunschperiode aus</li>
            <li>Trage deine WÃ¼nsche fÃ¼r die einzelnen Tage ein</li>
            <li>Alle Kollegen (MA1-MA15) kÃ¶nnen deine WÃ¼nsche sehen (Transparenz!)</li>
            <li>Urlaub und "gar nichts mÃ¶glich" benÃ¶tigen eine Genehmigung</li>
        </ol>
    </div>

    <!-- Perioden-Liste -->
    {% if perioden %}
        <div class="row">
            {% for periode in perioden %}
            <div class="col-md-6 mb-4">
                <div class="card h-100 
                    {% if periode.ist_offen %}border-success{% endif %}
                    {% if periode.status == 'geschlossen' %}border-secondary{% endif %}
                    {% if periode.status == 'veroeffentlicht' %}border-primary{% endif %}
                ">
                    <div class="card-header 
                        {% if periode.ist_offen %}bg-success text-white{% endif %}
                        {% if periode.status == 'geschlossen' %}bg-secondary text-white{% endif %}
                        {% if periode.status == 'veroeffentlicht' %}bg-primary text-white{% endif %}
                    ">
                        <h5 class="mb-0">
                            {{ periode.name }}
                            {% if periode.ist_offen %}
                                <span class="badge bg-light text-success float-end">OFFEN</span>
                            {% else %}
                                <span class="badge bg-light text-secondary float-end">{{ periode.get_status_display }}</span>
                            {% endif %}
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="mb-2">
                            <strong>ğŸ“… Monat:</strong> {{ periode.fuer_monat|date:"F Y" }}
                        </p>
                        <p class="mb-2">
                            <strong>ğŸ“ Eingabe:</strong> 
                            {{ periode.eingabe_start|date:"d.m.Y H:i" }} 
                            bis 
                            {{ periode.eingabe_ende|date:"d.m.Y H:i" }}
                        </p>
                        <p class="mb-3">
                            <strong>âœ… Meine WÃ¼nsche:</strong> 
                            <span class="badge bg-primary">{{ periode.eigene_wuensche_count }}</span>
                        </p>

                        <div class="d-grid gap-2">
                            {% if periode.ist_offen %}
                                <a href="{% url 'schichtplan:wunsch_kalender' periode.pk %}" 
                                   class="btn btn-success">
                                    ğŸ“ WÃ¼nsche eintragen/bearbeiten
                                </a>
                            {% else %}
                                <a href="{% url 'schichtplan:wunsch_kalender' periode.pk %}" 
                                   class="btn btn-outline-primary">
                                    ğŸ‘ï¸ WÃ¼nsche ansehen
                                </a>
                            {% endif %}
                        </div>
                    </div>
                    <div class="card-footer text-muted small">
                        <div class="d-flex justify-content-between">
                            <span>Gesamt: {{ periode.anzahl_wuensche }} WÃ¼nsche</span>
                            {% if periode.anzahl_genehmigungen_offen > 0 %}
                                <span class="text-warning">
                                    â³ {{ periode.anzahl_genehmigungen_offen }} warten auf Genehmigung
                                </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-warning py-4 text-center">
            <h5>âš ï¸ Keine Wunschperioden verfÃ¼gbar</h5>
            <p class="mb-3">
                Aktuell sind keine Perioden fÃ¼r Wunscheingaben geÃ¶ffnet. 
            </p>
            
            <!-- NEU: Call-to-Action fÃ¼r den Planer -->
            {% if ist_planer %}
                <hr>
                <p>Sie sind als Schichtplaner angemeldet. Erstellen Sie jetzt die erste Periode:</p>
                <a href="{% url 'schichtplan:periode_erstellen' %}" class="btn btn-primary">
                    ğŸš€ Erste Wunschperiode erstellen
                </a>
            {% else %}
                <p class="mb-0 text-muted">Bitte wenden Sie sich an Ihren Schichtplaner.</p>
            {% endif %}
        </div>
    {% endif %}

<style>
.card {
    transition: transform 0.2s, box-shadow 0.2s;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
</style>
{% endblock %}